<div class="relative  z-20 w-full bg-[#201a23] p-4 rounded-md">

  <!-- Toggle Button for Mobile -->
  <button
    class="bg-gray-800 text-white p-2 rounded-md w-full md:hidden flex items-center justify-between focus:outline-none focus:ring-2  focus:ring-blue-500 transition"
    (click)="toggleMobileFilters()">
    <span>Filters</span>
    <span class="material-icons">
      {{ mobileFiltersOpen ? 'expand_less' : 'expand_more' }}
    </span>
  </button>

  <!-- Mobile Filters Dropdown -->
  @if (mobileFiltersOpen) {
  <div class="mt-4 p-4 rounded-md space-y-4 relative z-30">
    <!-- Type Selector -->
    <select class="bg-gray-800 text-gray-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="movies">Movies</option>
      <option value="series">Series</option>
    </select>

    <!-- Category Selector -->
    <select class="bg-gray-800 text-gray-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="Popular">Popular</option>
      <option value="New">New</option>
      <option value="Top Rated">Top Rated</option>
      <option value="Now Playing">Now Playing</option>
    </select>

    <!-- Year Selector -->
    <select class="bg-gray-800 text-gray-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option [value]="0">Year</option>
      @for (year of years; track year) {
      <option [value]="year">{{ year }}</option>
      }
    </select>

    <!-- Genre Multi-Select -->
    <div class="relative" appClickOutside [context]="'mobile'" [triggerElement]="mobileGenreDropdownButton"
      (appClickOutside)="handleOutsideClick($event)">
      <button #mobileGenreDropdownButton
        class="bg-gray-800 text-gray-300 p-2 rounded w-full flex items-center justify-between hover:bg-gray-700 transition"
        (click)="toggleGenreDropdown('mobile'); $event.stopPropagation()">
        <span>Genres</span>
        @if (selectedGenres().length > 0) {
        <span class="bg-gray-600 text-gray-300 mr-28 px-2 py-1 rounded-full text-sm">
          {{ selectedGenres().length }}
        </span>
        }
        <span class="material-icons">
          {{ mobileGenreDropdownOpen() ? 'expand_less' : 'expand_more' }}
        </span>
      </button>
      @if (mobileGenreDropdownOpen()) {
      <div class="absolute mt-2 bg-gray-800 text-gray-300 rounded shadow-lg z-10 p-4 w-full"
        (click)="$event.stopPropagation()">
        @for (genre of genres; track genre) {
        <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-700 cursor-pointer"
          for="genre-{{ genre.id }}">
          <input id="genre-{{ genre.id }}" type="checkbox" [value]="genre.id"
            [checked]="selectedGenres().includes(genre.id)"
            (change)="updateSelectedGenres(genre.id, $any($event.target).checked)" />
          <span>{{ genre.name }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Studios/Networks Selector -->
    <select class="bg-gray-800 text-gray-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option [value]="0">{{ type === 'movies' ? 'Studios' : 'Network' }}</option>
      @for (studioNetwork of studiosOrNetworks; track studioNetwork) {
      <option [value]="studioNetwork.id">{{ studioNetwork.name }}</option>
      }
    </select>

    <!-- Keyword Input -->
    <div class="relative">
      <input type="text" placeholder="Search keyword"
        class="bg-gray-800 text-gray-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
        [value]="keywordInput()" (input)="onKeywordInput($any($event.target).value)" />
      @if (keywordResults().length > 0) {
      <ul class="absolute bg-gray-800 text-gray-300 rounded shadow-lg mt-2 w-full z-10 p-2">
        @for (keyword of keywordResults(); track keyword.id) {
        <li class="p-2 hover:bg-gray-700 cursor-pointer rounded" (click)="addKeyword(keyword)">
          {{ keyword.name }}
        </li>
        }
      </ul>
      }
    </div>

    <!-- Selected Keywords -->
    <div class="flex flex-wrap gap-2">
      @for (keyword of selectedKeywords(); track keyword.id) {
      <span class="bg-blue-600 text-white px-2 py-1 rounded flex items-center">
        {{ keyword.name }}
        <button class="ml-2 text-red-500" (click)="removeKeyword(keyword.id)">x</button>
      </span>
      }
    </div>
  </div>
  }


  <!-- Desktop Filters -->
  <div class="hidden md:flex flex-row items-center md:items-start space-x-4">
    <!-- Type Selector -->
    <select
      class="bg-gray-800 text-gray-300 p-2 rounded w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      [(ngModel)]="selectedType" (change)="updateFilter()">
      <option value="movies">Movies</option>
      <option value="series">Series</option>
    </select>

    <!-- Category Selector -->
    <select
      class="bg-gray-800 text-gray-300 p-2 rounded w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      [(ngModel)]="selectedCategory" (change)="updateFilter()">
      <option value="Popular">Popular</option>
      <option value="New">New</option>
      <option value="Top Rated">Top Rated</option>
      <option value="Now Playing">Now Playing</option>
    </select>

    <!-- Year Selector -->
    <select
      class="bg-gray-800 text-gray-300 p-2 rounded w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      [(ngModel)]="selectedYear" (change)="updateFilter()">
      <option [value]="0">Year</option>
      @for (year of years; track year) {
      <option [value]="year">{{ year }}</option>
      }
    </select>

    <!-- Genre Multi-Select -->
    <div class="relative" appClickOutside [context]="'desktop'" [triggerElement]="desktopGenreDropdownButton"
      (appClickOutside)="handleOutsideClick($event)">
      <button #desktopGenreDropdownButton
        class="bg-gray-800 text-gray-300 p-2 rounded flex items-center space-x-2 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        (click)="toggleGenreDropdown('desktop')">
        <span>Genres</span>
        @if (selectedGenres().length > 0) {
        <span class="bg-gray-600 text-gray-300 px-2 py-1 rounded-full text-sm">
          {{ selectedGenres().length }}
        </span>
        }
        <span class="material-icons">
          {{ desktopGenreDropdownOpen() ? 'expand_less' : 'expand_more' }}
        </span>
      </button>
      @if (desktopGenreDropdownOpen()) {
      <div class="absolute mt-2 bg-gray-800 text-gray-300 rounded shadow-lg z-10 p-4 w-40">
        @for (genre of genres; track genre) {
        <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-700 cursor-pointer"
          for="genre-{{ genre.id }}">
          <input id="genre-{{ genre.id }}" type="checkbox" [value]="genre.id"
            [checked]="selectedGenres().includes(genre.id)"
            (change)="updateSelectedGenres(genre.id, $any($event.target).checked)" />
          <span>{{ genre.name }}</span>
        </label>
        }
      </div>
      }
    </div>

    <!-- Studios/Networks Selector -->
    <select
      class="bg-gray-800 text-gray-300 p-2 rounded w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      [(ngModel)]="selectedStudiosOrNetworks" (change)="updateFilter()">
      <option [value]="0">{{ type === 'movies' ? 'Studios' : 'Network' }}</option>
      @for (studioNetwork of studiosOrNetworks; track studioNetwork) {
      <option [value]="studioNetwork.id">{{ studioNetwork.name }}</option>
      }
    </select>

    <!-- Keyword Input -->
    <div class="relative">
      <input type="text" placeholder="Search keyword"
        class="bg-gray-800 text-gray-300 p-2 rounded w-auto focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        [value]="keywordInput()" (input)="onKeywordInput($any($event.target).value)" />
      @if (keywordResults().length > 0) {
      <ul class="absolute bg-gray-800 text-gray-300 rounded shadow-lg mt-2 w-full z-10 p-2">
        @for (keyword of keywordResults(); track keyword.id) {
        <li class="p-2 hover:bg-gray-700 cursor-pointer rounded" (click)="addKeyword(keyword)">
          {{ keyword.name }}
        </li>
        }
      </ul>
      }
    </div>
  </div>
</div>